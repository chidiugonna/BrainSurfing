<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Introduction to Surface-based Formats - BrainSurfing</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Introduction to Surface-based Formats";
    var mkdocs_page_input_path = "surfdata/introformats.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> BrainSurfing</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Surface Formats</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Introduction to Surface-based Formats</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#volume-based-formats">Volume-based formats</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#what-is-a-surface-based-format">What is a surface-based format</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#when-are-surface-based-formats-appropriate">When are Surface-Based formats appropriate?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#why-use-surface-based-formats">Why use Surface-Based Formats?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#functional-and-anatomical-validity">Functional and anatomical validity</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#processing-accuracy-and-reliability">Processing accuracy and reliability</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#group-analysis">Group analysis</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#economyefficiency-of-representation">Economy/Efficiency of representation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-gifti-format">The GIFTI Format</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#historical-milestones">Historical milestones</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#obtaining-surface-based-models-today">Obtaining Surface-based models today</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#some-caveats">Some caveats</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#freesurfer-pipeline">Freesurfer Pipeline</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#freesurfer-outputs">Freesurfer Outputs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-ballad-of-surface-and-volume">The Ballad of Surface and Volume</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-cifti-format">The CIFTI format</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hcp-workbench">HCP Workbench</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#appendix-1-volume-vs-surface-model">Appendix 1: Volume vs Surface Model</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../formatref/">Neuroimaging Data Formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../prac81/">practicum 8.1</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Surface Analysis</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../surfanalysis/introanalysis/">Working with Surface-based formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../surfanalysis/analysisref/">Surface Analysis Pipelines</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../surfanalysis/prac91/">practicum 9.1</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">BrainSurfing</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Surface Formats &raquo;</li>
        
      
    
    <li>Introduction to Surface-based Formats</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="lesson-8-introduction-to-surface-based-formats">Lesson 8: Introduction to Surface-Based Formats</h1>
<h2 id="volume-based-formats">Volume-based formats</h2>
<p>Magnetic Resonance (MR) images are typically acquired as a 3D volume matrix of intensity values which represent the strength of tisue signal at contiguous volume pixels otherwise known as <strong>voxels</strong>. MRI voxel data is usually acquired in <a href="../formatref/#dicom"><strong>Dicom</strong></a> format but converted to <a href="../formatref/#nifti"><strong>Nifti</strong></a> format for most day to day processing tasks as the later is a much more tractable format to use.</p>
<p>A voxel location is specified by three indexes <strong>i</strong>, <strong>j</strong> and <strong>k</strong> which represent 3D cartesian space. A coordinate <strong>transform</strong> stored in the header of the Nifti allows one to map between the voxel space i,j,k and world coordinate space x, y, z in metric units (mm)</p>
<p><img alt="brainsurficon" src="../../img/voxel.png" /></p>
<h2 id="what-is-a-surface-based-format">What is a surface-based format</h2>
<p>Another approach to storing MRI data is to use a <strong>surface-based format</strong>. In this case tissue signal is recorded at distinct locations on the surface of an anatomical structure. These locations or <strong>vertices</strong> are specified by a single <strong>index</strong>  which is a unique identifier for the vertex. Vertices are connected to 2 other vertices by an <strong>edge</strong> to create a <strong>triangular face</strong>.</p>
<p>Many triangles are tesselated in a non-overlapping manner to create a  <strong>mesh</strong> that covers the entire surface. Each vertex  is associated with a real world 3D coordinate space location (<em>x,y,x</em>) just like a voxel which is usually in millimeter (mm) length units.See <a href="#Appendix1">Appendix 1</a> for a comparison between Surface based models and traditional volume-based models that has been reproduced from a Freesurfer course online.</p>
<p><img alt="brainsurficon" src="../../img/mesh.png" />
<em>Cortical surface reconstruction (image: Pirondini et al (2017) Computationally Efficient Algorithms for Sparse, Dynamic Solutions to the EEG Source Localization Problem</em></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>To fully represent a cortical surface (e.g. the boundary between white matter and gray matter) as a 3D model, then the following information is usually stored in a Surface-Based Format by Neuroimaging software:</p>
<ul>
<li>
<p>a list of all the vertices in that surface with their x, y and z coordinates in mm units. For a 1mm T1w image, Freesurfer uses  about 120,000 vertices to represent one of the hemispheres of the brain.</p>
</li>
<li>
<p>a list of all faces in that surface where a face is a set of three interconnected vertices. For a 1mm T1w image, Freesurfer uses about 300,000 faces to represent one of the surfaces.</p>
</li>
</ul>
<p>There isn't necessarilly a predictable way to determine the number of faces from the number of vertices. For example see 2 different configurations below with the same number of vertices.</p>
<p><img alt="brainsurficon" src="../../img/faces.png" /></p>
</div>
<p>For our purposes there are 2 categories of surface-based formats (in Freesurfer parlance):
* Meshes - these define the actual surface topology
* Overlays - these assign functional values to each vertex (e.g. thickness, curvature, myelin content, functional activation, BOLD signal, correlation etc..)</p>
<h2 id="when-are-surface-based-formats-appropriate">When are Surface-Based formats appropriate?</h2>
<p>Surface-based formats are only really useful if you have high resolution anatomical images that allow you to segment the brain into distinct tissue types and/or anatomical structures. They have found most utility for the analysis of the cerebral cortex due to its highly folded geometry which can lead to partial volume errors under regular volumetric analysis pipelines. The cerebellum is also a potential candidate for surface based analysis but requires extremely high resolution anatomical scans to resolve. See this recent paper by <a href="https://www.pnas.org/content/117/32/19538">Sereno et al 2020</a>.</p>
<h2 id="why-use-surface-based-formats">Why use Surface-Based Formats?</h2>
<p>Assuming you do have a good quality, high resolution (at least 1mm) T1w image (this is now accessible to most research groups), why would you want to bother working in surface space for the analysis of the cerebral cortex?</p>
<h3 id="functional-and-anatomical-validity">Functional and anatomical validity</h3>
<p>The cerebral cortex appears to display functional differentiation and organization in cortical areas on a 2-D surface. Functional experiments with visual stimuli have allowed the organization of primary visual areas to be distinctly identified using surface-based methods [Sereno et al 1995] as patches on a 2D flat map. Volumetric approaches have struggled to reveal this functional organization in primary visual cortex.</p>
<h3 id="processing-accuracy-and-reliability">Processing accuracy and reliability</h3>
<p>A follow on reason is that keeping the data in surface form prevents errors during the processing pipeline. In volumetric space, due to the highly convoluted nature of the cortex, adjacent voxels may actually be very distant from each other in reality. This is captured by vertex notation and allows preprocessing steps like smoothing, filtering, correlations and any actions that require an accurate inventory of spatial locations being used to operate with less error due to partial volume confounds.</p>
<h3 id="group-analysis">Group analysis</h3>
<p>There seems to be a correlation between cortical folds and function. Surface models use these surface features (gyri and sulci) which show correspondence across subjects to improve inter-subject registration which increases the accuracy of group analysis.</p>
<h3 id="economyefficiency-of-representation">Economy/Efficiency of representation</h3>
<p>Large areas of brain tissue that are redundant to the analysis can be ignored. Thus the cortex can be represented using smaller file sizes in surface space. This makes the creation of dense connectomes feasible (albeit still computationally intensive) where they were barely manageable in voxel space. This also has an impact with respect to multiple comparisons in univariate whole-brain statistical anaysis.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Another way that economy could be achieved in general is by using fewer vertices in regions where curvature is reduced so that slowly changing geometry is represented by larger triangles. In practice this is not done in neuroimaging as the uniform sampling of vertices is also important for modalities such as functional mri and so vertices are usually created at a fairly regular inteval of ~1mm in Freesurfer.</p>
</div>
<h2 id="the-gifti-format">The GIFTI Format</h2>
<p>The <a href="../formatref/#gifti">Gifti</a> Data Format is used to represent surface-based data. A nice overview of GIFTI and CIFTI files is provided on the <a href="https://balsa.wustl.edu/about/fileTypes">balsa</a> website. The <a href="http://www.nitrc.org/projects/gifti/">GIFTI specifications</a> provide more details on the format itself.</p>
<p>The GIFTI header describes the metadata of the surface information in xml format. The actual data is stored after the header. The GIFTI file can be in ascii or compressed base 64 format.</p>
<ul>
<li>The GIFTI format has the extension <code>.gii</code>.</li>
<li>Mesh model captures the vertex locations and vertex neighbourhood in a <code>*.surf.gii</code> file</li>
<li>Other derived files like <code>*.func.gii</code> and  <code>*.shape.gii</code> and <code>*.label.gii</code> in combination with the <code>surf.gii</code> file, support derived measures like fMRI time series, curvature, and parcel labels respectively.  </li>
</ul>
<h2 id="historical-milestones">Historical milestones</h2>
<ul>
<li>Sereno</li>
<li>Van Essen - Caret</li>
<li>Dale and Fischl</li>
<li>etc..</li>
</ul>
<h2 id="obtaining-surface-based-models-today">Obtaining Surface-based models today</h2>
<p>There are several approaches to creating an accurate surface model from a T1w image. The open source software <strong>FreeSurfer</strong> {Fischl 2012] is the most established and most widely used package and uses a number of sophisticated algorithms and procedures to take a T1w image, segment it into tissue classes and then identify the boundary points between these tissue clases which then form the surfaces that are the foundation of the surface model.</p>
<h2 id="some-caveats">Some caveats</h2>
<p>While the Freesurfer pipeline is usually adequate for most standard pipelines it is possible that if you are studying a less representative population like neonates, children or lesioned/sectioned brains [Makrapoulos 2018] for which Freesurfer is not optimized (for children under 5, white matter is  unmyelinated so contrast between grey and white is ambiguous)  then you may need to tweak the pipeline or find/develop alternative approaches. Indeed the HCP project worked with the Freesurfer team to develop a version of Freesurfer that could work with higher resolution T1w and T2w images using the <code>--hires</code> flag.</p>
<p>The high-resolution layer-fMRI community is also split on their advocacy for freesurfer with some researchers using it and others deciding to create their own pipelines. See this dicussion by <a href="https://layerfmri.com/2018/01/04/layer-fmri-software-in-the-field/">Renzo Huber</a></p>
<h2 id="freesurfer-pipeline">Freesurfer Pipeline</h2>
<p>The freesurfer pipeline is the standard approach to creating surface models. We provide an overview of the pipeline here which are covered in detail by [Dale et al 1998] and [Fischl et al 1998].</p>
<ul>
<li>Segmentation</li>
<li>Bias-field correction</li>
<li>etc.</li>
</ul>
<h2 id="freesurfer-outputs">Freesurfer Outputs</h2>
<p>Freesurfer outputs surface and volume files. Some of these files <code>.pial</code>. <code>.white</code>, etc are in Freesurfers native surface format. Others are provided in the GIFTI format. The GIFTI <a href="https://github.com/gllmflndn/gifti">matlab library</a> is a versatile package that supports several surface models (like freesurfer, VTK and others) as well as standard GIFTI formats.</p>
<h2 id="the-ballad-of-surface-and-volume">The Ballad of Surface and Volume</h2>
<pre><code>Oh Surface is Surface, and Volume is Volume, and never the twain shall meet,
But there is neither Surface nor Volume, Border, nor Area, nor Origin

  - CIFTI
</code></pre>
<p>The GIFTI format is able to manage most requirements for representing surface data however in some cases it is useful to be able to manage both surface and volume models together. For example if one wanted to calculate correlations between vertices on the surface and voxels in a subcortical structure like the hippocampus. The <a href="../formatref/#cifti">CIFTI</a> format provides support for this scenario. The CIFTI format relies on the <a href="../formatref/#nifti-2">NIFTI-2</a> format as the original <a href="../formatref/#nifti">NIFTI</a> is restricted to 32767 values in each dimension which is not sufficient to support high resolution surface models which can have as many as 164,000 vertices. </p>
<h2 id="the-cifti-format">The CIFTI format</h2>
<p>CIFTI format used to support both volume and surface data in the same file. Each CIFTI file with surface information is linked to an external gifti surf file which describes the vertex locations and topology.</p>
<p>The CIFTI file header is stored in the NIFTI-2 extensions section in xml format and describes all the metadata for the data.</p>
<p>The actual vertex and voxel data is stored in row-major format in the file.</p>
<h2 id="hcp-workbench">HCP Workbench</h2>
<p>Like freeview will allow us to view GIFTIs and CIFTIs.</p>
<h2 id="appendix-1-volume-vs-surface-model">Appendix 1: Volume vs Surface Model</h2>
<p>This table was culled from this <a href="https://www.youtube.com/watch?v=KncPouQWAp0">presentation</a>.</p>
<table>
<thead>
<tr>
<th><div style="width:300px">Volume</div></th>
<th><div style="width:300px">Surface</div></th>
</tr>
</thead>
<tbody>
<tr>
<td>Uniform grid</td>
<td>Non-uniform grid</td>
</tr>
<tr>
<td>Voxel intersection of grid lines</td>
<td>Vertex is intersection of triangles</td>
</tr>
<tr>
<td>Columns, rows, slices</td>
<td>Vertex index</td>
</tr>
<tr>
<td>Voxel size/distance is fixed</td>
<td>Distance between vertices ~ 1mm</td>
</tr>
<tr>
<td>Voxel assigned a value</td>
<td>Vertex assigned a value</td>
</tr>
<tr>
<td>Voxel located at x,y,z (mm)</td>
<td>Vertex located at x,y,x (mm)</td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../formatref/" class="btn btn-neutral float-right" title="Neuroimaging Data Formats">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../about/" class="btn btn-neutral" title="About"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../about/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../formatref/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
